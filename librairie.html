<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bibliothèque TurboDrive</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header {
            background-color: #222222;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
        .header .logo {
            font-size: 1.8em;
            font-weight: 800;
            color: #ffffff;
            text-decoration: none;
        }
        .header .nav-links a {
            color: #ffffff;
            text-decoration: none;
            margin-left: 30px;
            font-weight: 600;
            font-size: 1.1em;
            transition: color 0.3s ease;
        }
        .header .nav-links a:hover {
            color: #e94560;
        }
        .header .menu-icon {
            display: none;
            font-size: 1.8em;
            cursor: pointer;
        }
        .content-container {
            max-width: 1200px;
            margin: 100px auto 40px auto; /* Ajuster pour l'en-tête fixe */
            padding: 0 20px;
            flex-grow: 1;
            text-align: center;
        }
        .content-container h1 {
            font-size: 2.5em;
            color: #e94560;
            margin-bottom: 20px;
        }
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }
        .photo-card {
            background-color: #2a2a2a;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            transition: transform 0.2s ease-in-out;
        }
        .photo-card:hover {
            transform: translateY(-5px);
        }
        .photo-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }
        .photo-card .description {
            padding: 15px;
            font-size: 1em;
            color: #cccccc;
        }
        .loading-message {
            color: #cccccc;
            font-size: 1.2em;
            margin-top: 50px;
        }
        footer {
            background-color: #111111;
            color: #cccccc;
            padding: 30px 20px;
            text-align: center;
            font-size: 0.9em;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
            margin-top: auto; /* Pousser le pied de page vers le bas */
        }
        footer a {
            color: #007bff;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        footer a:hover {
            color: #e94560;
        }
        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
            }
            .header .nav-links {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 70px;
                left: 0;
                width: 100%;
                background-color: #222222;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
                z-index: 1000;
            }
            .header .nav-links.active {
                display: flex;
            }
            .header .menu-icon {
                display: block;
            }
            .content-container {
                margin-top: 80px;
                padding: 0 15px;
            }
            .content-container h1 {
                font-size: 2em;
            }
            .gallery {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="index.html" class="logo">TurboDrive</a>
        <nav class="nav-links" id="navLinks">
            <a href="librairie.html">LIBRAIRIE</a>
        </nav>
        <div class="menu-icon" id="menuIcon">
            <i class="fas fa-bars"></i>
        </div>
    </header>

    <main class="flex flex-col items-center flex-grow">
        <div class="content-container">
            <h1>Notre Librairie de Photos</h1>
            <p class="loading-message" id="loadingMessage">Chargement des photos depuis GitHub...</p>
            <div id="gallery" class="gallery">
                <!-- Les photos seront chargées ici par JavaScript -->
            </div>
            <p class="text-sm text-gray-500 mt-8">
                **Note importante :** Les photos sont chargées directement depuis l'API publique de GitHub. Cette méthode est sujette aux limites de taux (60 requêtes par heure par adresse IP). Si la galerie ne s'affiche pas, veuillez réessayer plus tard ou vérifier que votre dépôt est public.
            </p>
        </div>
    </main>

    <footer>
        <p>© 2025 TurboDrive. Tous droits réservés. <a href="pdc.html">Fichiers utiles</a></p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuIcon = document.getElementById('menuIcon');
            const navLinks = document.getElementById('navLinks');
            const gallery = document.getElementById('gallery');
            const loadingMessage = document.getElementById('loadingMessage');

            if (menuIcon && navLinks) {
                menuIcon.addEventListener('click', () => {
                    navLinks.classList.toggle('active');
                });
            }

            const GITHUB_REPO_OWNER = 'nolan436';
            const GITHUB_REPO_NAME = 'photos-turbodrive-librairie';
            const GITHUB_IMAGES_PATH = 'images'; 
            const GITHUB_API_URL = `https://api.github.com/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/${GITHUB_IMAGES_PATH}`;

            async function fetchPhotosFromGitHub() {
                loadingMessage.style.display = 'block';
                gallery.innerHTML = ''; 

                try {
                    const response = await fetch(GITHUB_API_URL, {
                        headers: {
                            'Accept': 'application/vnd.github.v3+json' 
                        }
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        let errorMessage = `Erreur lors de la récupération des photos depuis GitHub: ${errorData.message || response.statusText}.`;
                        if (response.status === 403 && errorData.message.includes('rate limit exceeded')) {
                            errorMessage += " La limite de requêtes API de GitHub a été atteinte. Veuillez réessayer plus tard.";
                        } else if (response.status === 404) {
                            errorMessage += " Assurez-vous que le dépôt et le dossier 'images/' existent et sont publics.";
                        }
                        throw new Error(errorMessage);
                    }

                    const files = await response.json();

                    const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg'];
                    const photos = files
                        .filter(file => file.type === 'file' && imageExtensions.some(ext => file.name.toLowerCase().endsWith(ext)))
                        .map(file => ({
                            url: file.download_url,
                            description: file.name.split('.')[0].replace(/[-_]/g, ' ') 
                        }));

                    if (photos.length === 0) {
                        gallery.innerHTML = '<p class="col-span-full text-center text-gray-400">Aucune photo trouvée dans le dossier "images/" de votre dépôt GitHub.</p>';
                    } else {
                        photos.forEach(photo => {
                            const photoCard = document.createElement('div');
                            photoCard.classList.add('photo-card');
                            photoCard.innerHTML = `
                                <img src="${photo.url}" alt="${photo.description}" onerror="this.onerror=null;this.src='https://placehold.co/400x200/333333/ffffff?text=Image+introuvable';" loading="lazy">
                                <div class="description">${photo.description}</div>
                            `;
                            gallery.appendChild(photoCard);
                        });
                    }
                } catch (error) {
                    console.error("Erreur:", error);
                    gallery.innerHTML = `<p class="col-span-full text-center text-red-500">${error.message}</p>`;
                } finally {
                    loadingMessage.style.display = 'none'; 
                }
            }

            fetchPhotosFromGitHub(); 
        });
    </script>
</body>
</html>
